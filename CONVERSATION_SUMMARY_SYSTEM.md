# –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑—é–º–µ —Ä–æ–∑–º–æ–≤–∏ (Conversation Summary System)

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

–ö–æ–ª–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —Ä–æ–∑–º–æ–≤—ñ –ø–µ—Ä–µ–≤–∏—â—É—î –ª—ñ–º—ñ—Ç (10 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å), —Å—Ç–∞—Ä—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó —Ç–æ–∫–µ–Ω—ñ–≤. –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –≤—Ç—Ä–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É - –®–Ü –∑–∞–±—É–≤–∞—î, —â–æ –≤—ñ–Ω —Ä–∞–Ω—ñ—à–µ –∑–∞–ø–∏—Ç—É–≤–∞–≤, —ñ –ø–æ—á–∏–Ω–∞—î –≤—Å–µ –∑–∞–Ω–æ–≤–æ.

## –†—ñ—à–µ–Ω–Ω—è

–°—Ç–≤–æ—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∑—é–º–µ, —è–∫–∞:
1. **–ê–Ω–∞–ª—ñ–∑—É—î –≤–∏–¥–∞–ª–µ–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** —ñ —Å—Ç–≤–æ—Ä—é—î –∫–æ—Ä–æ—Ç–∫–µ —Ä–µ–∑—é–º–µ –∫–ª—é—á–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
2. **–ó–±–µ—Ä—ñ–≥–∞—î –∫–æ–Ω—Ç–µ–∫—Å—Ç** –º—ñ–∂ —Å–µ—Å—ñ—è–º–∏ —Ä–æ–∑–º–æ–≤–∏
3. **–ù–∞—Ä–æ—â—É—î —Ä–µ–∑—é–º–µ** - –∫–æ–∂–Ω–µ –Ω–æ–≤–µ —Ä–µ–∑—é–º–µ –æ–±'—î–¥–Ω—É—î—Ç—å—Å—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º
4. **–í–∫–ª—é—á–∞—î —Ä–µ–∑—é–º–µ –≤ –ø—Ä–æ–º–ø—Ç** –¥–ª—è –®–Ü, —â–æ–± –≤—ñ–Ω –ø–∞–º'—è—Ç–∞–≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–π–ª–∏
- `services/conversationSummary.ts` - –æ—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤—ñ—Å —Ä–µ–∑—é–º–µ
- `services/claude.ts` - –æ–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ–∑—é–º–µ
- `app/ai-story.tsx` - –æ–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ conversationId

### –ö–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

#### ConversationSummaryService
```typescript
interface ConversationSummary {
  keyTopics: string[];        // –ö–ª—é—á–æ–≤—ñ —Ç–µ–º–∏ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è
  userPreferences: string[];  // –Ü–Ω—Ç–µ—Ä–µ—Å–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  corrections: string[];      // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≥—Ä–∞–º–∞—Ç–∏–∫–∏
  vocabulary: string[];       // –ù–æ–≤–∞ –ª–µ–∫—Å–∏–∫–∞
  grammarPoints: string[];    // –ì—Ä–∞–º–∞—Ç–∏—á–Ω—ñ –º–æ–º–µ–Ω—Ç–∏
  context: string;           // –ó–∞–≥–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  lastUpdated: Date;         // –ß–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
}
```

#### –ú–µ—Ç–æ–¥–∏ —Å–µ—Ä–≤—ñ—Å—É
- `generateSummary()` - —Å—Ç–≤–æ—Ä—é—î —Ä–µ–∑—é–º–µ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- `updateSummary()` - –æ–Ω–æ–≤–ª—é—î —ñ—Å–Ω—É—é—á–µ —Ä–µ–∑—é–º–µ
- `formatSummaryForPrompt()` - —Ñ–æ—Ä–º–∞—Ç—É—î –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—è –≤ –ø—Ä–æ–º–ø—Ç
- `getSummary()` - –æ—Ç—Ä–∏–º—É—î —Ä–µ–∑—é–º–µ –∑–∞ ID —Ä–æ–∑–º–æ–≤–∏

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑—é–º–µ
–ö–æ–ª–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å > 10:
```typescript
// –ë–µ—Ä–µ–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫—ñ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ
const messagesToSummarize = messages.slice(0, -10);

// –ì–µ–Ω–µ—Ä—É—î–º–æ —Ä–µ–∑—é–º–µ —á–µ—Ä–µ–∑ Claude AI
const summary = await conversationSummaryService.generateSummary(
  conversationId,
  messagesToSummarize,
  topic,
  level
);
```

### 2. –ê–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ AI
Claude –∞–Ω–∞–ª—ñ–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —ñ —Å—Ç–≤–æ—Ä—é—î —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ —Ä–µ–∑—é–º–µ:
```json
{
  "keyTopics": ["Paris travel", "hotels", "museums"],
  "userPreferences": ["French food", "city center"],
  "corrections": ["I go ‚Üí I went", "I like ‚Üí I would like"],
  "vocabulary": ["accommodation", "landmark", "budget"],
  "grammarPoints": ["past tense", "conditional"],
  "context": "Planning first trip to Paris, looking for hotel near Eiffel Tower"
}
```

### 3. –ù–∞—Ä–æ—â—É–≤–∞–Ω–Ω—è —Ä–µ–∑—é–º–µ
–ö–æ–∂–Ω–µ –Ω–æ–≤–µ —Ä–µ–∑—é–º–µ –æ–±'—î–¥–Ω—É—î—Ç—å—Å—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º:
```typescript
const updatedSummary = {
  keyTopics: [...existing.keyTopics, ...new.keyTopics],
  userPreferences: [...existing.userPreferences, ...new.userPreferences],
  // ... —ñ–Ω—à—ñ –ø–æ–ª—è
};
```

### 4. –í–∫–ª—é—á–µ–Ω–Ω—è –≤ –ø—Ä–æ–º–ø—Ç
–†–µ–∑—é–º–µ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –ø—Ä–æ–º–ø—Ç—É –ø–µ—Ä–µ–¥ —ñ—Å—Ç–æ—Ä—ñ—î—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:
```
CONVERSATION SUMMARY:
Key topics: Paris travel, hotels, museums
User interests: French food, city center
Previous corrections: I go ‚Üí I went, I like ‚Üí I would like
Introduced vocabulary: accommodation, landmark, budget
Grammar points: past tense, conditional
Context: Planning first trip to Paris, looking for hotel near Eiffel Tower

Previous conversation:
Student: I want to visit the Arc de Triomphe
You: Great choice! It's a must-see landmark...
```

## –ü–µ—Ä–µ–≤–∞–≥–∏

### ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –®–Ü –ø–∞–º'—è—Ç–∞—î –∫–ª—é—á–æ–≤—ñ —Ç–µ–º–∏ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è
- –ù–µ –ø–æ–≤—Ç–æ—Ä—é—î –≤–∂–µ –∑–∞–¥–∞–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è
- –ü—Ä–æ–¥–æ–≤–∂—É—î —Ä–æ–∑–º–æ–≤—É –∑ —Ç–æ–≥–æ –º—ñ—Å—Ü—è, –¥–µ –∑—É–ø–∏–Ω–∏–≤—Å—è

### ‚úÖ –ï–∫–æ–Ω–æ–º—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤
- –†–µ–∑—é–º–µ –∑–∞–π–º–∞—î ~200-300 —Ç–æ–∫–µ–Ω—ñ–≤
- –ó–∞–º—ñ—Å—Ç—å 1000+ —Ç–æ–∫–µ–Ω—ñ–≤ –ø–æ–≤–Ω–æ—ó —ñ—Å—Ç–æ—Ä—ñ—ó
- –ï–∫–æ–Ω–æ–º—ñ—è ~70-80% —Ç–æ–∫–µ–Ω—ñ–≤

### ‚úÖ –Ø–∫—ñ—Å—Ç—å —Ä–æ–∑–º–æ–≤–∏
- –ë—ñ–ª—å—à –ø—Ä–∏—Ä–æ–¥–Ω–∞ —Ç–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∞ —Ä–æ–∑–º–æ–≤–∞
- –®–Ü —Ä–æ–∑—É–º—ñ—î –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–∞ —ñ–Ω—Ç–µ—Ä–µ—Å–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ö—Ä–∞—â—ñ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

### ‚úÖ –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –¥–ª—è –¥–æ–≤–≥–∏—Ö —Ä–æ–∑–º–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–∑—é–º–µ
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±–∞–≥–∞—Ç—å–æ—Ö –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö —Ä–æ–∑–º–æ–≤

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –í –∫–æ–¥—ñ
```typescript
// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∑ ID —Ä–æ–∑–º–æ–≤–∏
const context: ConversationContext = {
  topic: 'travel',
  level: 'intermediate',
  conversationHistory: [...],
  conversationId: 'unique-conversation-id'
};

// –†–µ–∑—é–º–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —Ç–∞ –≤–∫–ª—é—á–∞—î—Ç—å—Å—è –≤ –ø—Ä–æ–º–ø—Ç
const response = await claudeService.generateResponse(context, userMessage);
```

### –£ –ø—Ä–æ–º–ø—Ç—ñ
–†–µ–∑—é–º–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–¥ —ñ—Å—Ç–æ—Ä—ñ—î—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:
```
[System Prompt]
[Conversation Summary]
[Recent Messages (last 10)]
[Current User Message]
```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –õ—ñ–º—ñ—Ç–∏ —Ä–µ–∑—é–º–µ
```typescript
// –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –º–∞—Å–∏–≤–∞—Ö
keyTopics: 8
userPreferences: 6
corrections: 10
vocabulary: 15
grammarPoints: 8
```

### –ú–æ–¥–µ–ª—å AI
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `claude-3-5-haiku-20241022`
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É
- –ù–∏–∑—å–∫–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å (~$0.0001 –∑–∞ —Ä–µ–∑—é–º–µ)

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥—É–≤–∞–Ω–Ω—è
```typescript
console.log('üìù Generated conversation summary:', summary);
console.log('üìù Updated conversation summary:', updatedSummary);
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```typescript
const stats = conversationSummaryService.getSummaryStats();
// { totalSummaries: 5, activeConversations: 3 }
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª:
```bash
node test-summary.js
```

–¶–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å:
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—é —Ä–µ–∑—é–º–µ
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–∑—é–º–µ
- –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–º–ø—Ç—É
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

## –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### JSON –ü–∞—Ä—Å–∏–Ω–≥
–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞—î –ø–æ–∫—Ä–∞—â–µ–Ω—É –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ –¥–ª—è JSON –ø–∞—Ä—Å–∏–Ω–≥—É:

1. **–ü–æ—à—É–∫ JSON –≤ —Ç–µ–∫—Å—Ç—ñ** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î regex –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è JSON –æ–±'—î–∫—Ç–∞
2. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤** - –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ –≤—Å—ñ –ø–æ–ª—è –º–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Ç–∏–ø–∏
3. **Fallback –º–µ—Ö–∞–Ω—ñ–∑–º** - —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ—Å—Ç–µ —Ä–µ–∑—é–º–µ –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –ø–∞—Ä—Å–∏–Ω–≥—É
4. **–î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è** - –∑–±–µ—Ä—ñ–≥–∞—î –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –ø—Ä–æ–º–ø—Ç
```
IMPORTANT: Respond ONLY with valid JSON. No additional text before or after.
Return ONLY the JSON object, no explanations or additional text.
```

## –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

1. **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è** - –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ä–µ–∑—é–º–µ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
2. **–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞** - –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ä–µ–∑—é–º–µ
3. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è** - –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—é
4. **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** - –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö –º–æ–≤ –¥–ª—è —Ä–µ–∑—é–º–µ
5. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏** - —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –Ω–µ–≤–∞–∂–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é

## –í–∏—Å–Ω–æ–≤–æ–∫

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑—é–º–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É –≤—Ç—Ä–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø—Ä–∏ –æ–±—Ä—ñ–∑–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –®–Ü —Ç–µ–ø–µ—Ä –ø–∞–º'—è—Ç–∞—î –∫–ª—é—á–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —á–∞—Å—Ç–∏–Ω —Ä–æ–∑–º–æ–≤–∏ —ñ –º–æ–∂–µ –≤–µ—Å—Ç–∏ –±—ñ–ª—å—à –ø—Ä–∏—Ä–æ–¥–Ω—É —Ç–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—É –±–µ—Å—ñ–¥—É. 