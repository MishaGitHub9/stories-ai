# Система лімітів для Storylish

## Огляд

Ми створили повну систему лімітів для додатку Storylish, яка дозволяє користувачам безкоштовно користуватися базовими функціями, а потім переходити на преміум підписку для отримання необмеженого доступу.

## Основні компоненти

### 1. База даних (database/schema.sql)

Створено нові таблиці:
- `anonymous_users` - для анонімних користувачів (без реєстрації)
- `user_limits` - для відстеження лімітів зареєстрованих користувачів
- `stories` - для зберігання історій
- `story_messages` - для зберігання повідомлень в історіях
- `subscriptions` - для управління підписками

### 2. Хук useLimits (hooks/useLimits.ts)

Основний хук для роботи з лімітами:
- Підтримка анонімних та зареєстрованих користувачів
- Автоматичне скидання лімітів щодня
- Перевірка статусу підписки
- Збільшення лічильників використання

### 3. Компоненти UI

#### LimitsIndicator (components/LimitsIndicator.tsx)
- Показує поточні ліміти користувача
- Візуальні індикатори прогресу
- Компактний та повний режими відображення

#### LimitReachedModal (components/LimitReachedModal.tsx)
- Модальне вікно при досягненні ліміту
- Різні повідомлення для анонімних та зареєстрованих користувачів
- Кнопки для переходу на реєстрацію або підписку

## Ліміти

### Безкоштовні користувачі (анонімні та зареєстровані)
- **3 історії на день** - можна згенерувати або почати
- **10 повідомлень на день** - можна відправити в чаті
- **Без перекладу** - функція перекладу недоступна

### Преміум користувачі (підписка)
- **Необмежена кількість історій**
- **Необмежена кількість повідомлень**
- **Функція перекладу** доступна
- **3-денний безкоштовний пробний період**

## Логіка роботи

### Для анонімних користувачів:
1. При першому запуску створюється запис в `anonymous_users` з унікальним `device_id`
2. Ліміти відстежуються щодня
3. При досягненні ліміту показується модальне вікно з пропозицією створити акаунт

### Для зареєстрованих користувачів:
1. При реєстрації автоматично створюється запис в `user_limits`
2. Ліміти відстежуються щодня
3. При досягненні ліміту показується модальне вікно з пропозицією оформити підписку

### Пробний період:
1. Користувач створює акаунт
2. Оформлює підписку з 3-денним пробним періодом
3. Отримує необмежений доступ на 3 дні
4. Може скасувати підписку в будь-який момент

## Інтеграція в екрани

### 1. Екран вибору історій (app/story-mode.tsx)
- Додано індикатор лімітів історій
- Перевірка ліміту перед початком історії
- Модальне вікно при досягненні ліміту

### 2. AI-режим (app/ai-mode.tsx)
- Додано індикатор лімітів історій
- Перевірка ліміту перед початком AI-історії
- Модальне вікно при досягненні ліміту

### 3. AI-історія (app/ai-story.tsx)
- Додано компактний індикатор лімітів повідомлень
- Перевірка ліміту перед відправкою повідомлення
- Модальне вікно при досягненні ліміту
- Перевірка підписки для функції перекладу

### 4. Екран підписки (app/subscription.tsx)
- Повністю перероблений екран
- Два плани: місячний та річний
- Інформація про пробний період
- Перевірка наявності акаунта

## Наступні кроки

### 1. Платіжна система
Потрібно інтегрувати реальну платіжну систему (Stripe, Apple Pay, Google Pay):
- Додати API для створення підписок
- Обробка платежів
- Верифікація підписок

### 2. Адміністративна панель
Створити панель для управління:
- Перегляд статистики використання
- Управління підписками
- Аналітика конверсії

### 3. Push-повідомлення
Додати повідомлення:
- Нагадування про закінчення пробного періоду
- Пропозиції оновити підписку
- Нові функції для преміум користувачів

## Технічні деталі

### Залежності
Додано нові пакети:
```bash
npm install expo-device @react-native-async-storage/async-storage
```

### Безпека
- Row Level Security (RLS) увімкнено для всіх таблиць
- Політики безпеки для захисту даних користувачів
- Унікальні ID пристроїв для анонімних користувачів

### Продуктивність
- Індекси для швидкого пошуку
- Автоматичне скидання лімітів через SQL функції
- Кешування даних у локальному сховищі

## Тестування

### Сценарії для тестування:
1. **Анонімний користувач:**
   - Генерація 3 історій
   - Відправка 10 повідомлень
   - Перевірка блокування після досягнення ліміту

2. **Зареєстрований користувач:**
   - Реєстрація акаунта
   - Використання лімітів
   - Оформлення підписки

3. **Преміум користувач:**
   - Необмежене використання
   - Функція перекладу
   - Скасування підписки

## Висновок

Система лімітів повністю готова до використання. Вона забезпечує:
- Плавний перехід від безкоштовного до платного використання
- Зручний UX з індикаторами та модальними вікнами
- Гнучку архітектуру для майбутніх розширень
- Безпечне зберігання та обробку даних 